
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12. FlexSpec 1 Ecosystem &#8212; FlexSpec1 0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="13. Communications" href="communication.html" />
    <link rel="prev" title="11. Remote Protocol" href="protocol.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="flexspec-1-ecosystem">
<span id="fs1-ecosystem"></span><h1><span class="section-number">12. </span>FlexSpec 1 Ecosystem<a class="headerlink" href="#flexspec-1-ecosystem" title="Permalink to this headline">¶</a></h1>
<p>Use Case: Develop a basic GUI to Arduino Test case that will be the
basis for all Arduinos.</p>
<div class="figure align-default" id="id1">
<img alt="_images/PiggyBackBllinky.png" src="_images/PiggyBackBllinky.png" />
<p class="caption"><span class="caption-text">PiggyBack is the name of an Arduino, on an OTA, “piggybacked” onto
the main spectrgraph OTA. The On/Off radio buttons originate
a message down to the device. It advertises text in a SandStone
coloured box, and allows a integer value to be entered for the
Pause Rate and Cycle Count for the Blinky Object Chain.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="control-overview">
<h2><span class="section-number">12.1. </span>Control Overview<a class="headerlink" href="#control-overview" title="Permalink to this headline">¶</a></h2>
<p>The FlexSpec 1 is designed to live with other devices under the umbrella
of a main scheduler. This requires partitioning each subsystem, and its
components in a way that information can be shared at within the instrument,
between other instruments, shared resources at a site and between other
layers within a master scheduler. The architecture of FlexSpec 1 is open.</p>
<div class="figure align-default" id="id2">
<img alt="_images/FlexSpec_Comm_Regional.png" src="_images/FlexSpec_Comm_Regional.png" />
<p class="caption"><span class="caption-text">Seen from the point-of-view of the Main OTA: The Raspberry PI has three means of communication: Ethernet with the world; Serial (1.8V/Voltage management) with Arduino SBMs; I2C for short haul with SMBs and stand alone sensors. Each sub-system is managed by its own collection of C++/Python classes.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The best way to approach the control structure is to start at the distal
end of the control message chain – the actual component being controlled.</p>
<p>The component is implemented using a C++ class within the arduino. There
may be a few implementations of these classes – depending on the
architectural type of the Arduino/other device used. C++ classes
are used, as several of the same component may appear in one FlexSpec 1
instrument. They are disambiguated using a name.</p>
<p>Classes consist of “data+methods”. The data is always present when
included in a compiled program. However the data portion is only
created when a class is instantiated.</p>
<div class="figure align-default" id="id3">
<img alt="_images/GUI_Hardware.png" src="_images/GUI_Hardware.png" />
<p class="caption"><span class="caption-text">The Ethernet provides a potential connection to the world. The Browser in the world serves a HTML DIV for each of the instantiated devices, shown here with a darker green background. Here we have a power block “Blinky Power” – with lots of switches; A LowRez configuration spectrograph with its slit positioner, its grating selector and a Calibration Lamp for NeAr.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>In the figure, each “instantiated device”. In the case of the Slit
Positioner “Slit LoRez” a motor, that is permitted to make full
rotations. It is controlled by an instance of a C++ class running
within its controlling Arduino. It is physically wired and resides on
a multi-drop line. The “shim” that connects this physical device to
the outside world is an instance of a Bokeh class that translates the
HTML/JSNode events from the Browser into JSON strings to be shipped to
its associated widget within one of the arduinos attached to this
system. This is a common widely used protocol – borrowed mostly from
the Data Visualization Community. It is extremely platform independent.</p>
<p>You can control your system with any enabled browser, on any device,
anywhere you are allowed to go: including NASA’s Deep Space Network.</p>
<p>a C++ class instance running on an arduino connected by a “RS-232” type interface to its controlling Arduino residing on a multi-drop</p>
<p>Scenario: Consider temperature sensors.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The generic temperature sensor: FlexTemperature
Data: string Name
Methods:
  FlexTemperature() // constructor
  FlexTemperature(const string &amp;ref)
  void status(Message&lt;x,y&gt; &amp;response)
  static FlexTemperature *factory(const string &amp;ref)
</pre></div>
</div>
<p>In general a non-initialized constructor is only supported for
development. It costs nothing in terms of the code.</p>
<p>The construction with initialization capability of the form
FlexTemperature(const string &amp;ref). The string is a narrow
subset of a JSON structure. The syntax is described</p>
<p>This spectrograph uses several small single board computers with a serial
protocol to control:</p>
<ul class="simple">
<li><p>Slit selection</p></li>
<li><p>Grating selection</p></li>
<li><p>Focus of the colliminating lens</p></li>
<li><p>Enabling one or more calibration lamps</p>
<ul>
<li><p>High voltage lamps require a duty cycle</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>High intensity (boosting blue) requires short cycle times</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Colour LEDs to support gross grating position</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><p>A slit back-illumination lamp</p></li>
<li><p>Sensors for temperature and other aspects</p></li>
<li><p>Orientation for parallactic angle measurement</p></li>
</ul>
<p>The control elements essentially boil down to:</p>
<ul class="simple">
<li><p>Motor</p></li>
<li><p>Sensor</p></li>
<li><p>Switch</p></li>
</ul>
</div>
<div class="section" id="control-system">
<span id="fs1-control"></span><h2><span class="section-number">12.2. </span>Control System<a class="headerlink" href="#control-system" title="Permalink to this headline">¶</a></h2>
<p>The critical part of the control system is the device to be control.
The devices essentially fall into three main categories:</p>
<ol class="arabic simple">
<li><p>Sensor</p></li>
<li><p>Switch</p></li>
<li><p>Motor</p></li>
</ol>
</div>
<div class="section" id="flexjson-narrow-json-description">
<span id="flexjson"></span><h2><span class="section-number">12.3. </span>FlexJSON – Narrow JSON Description<a class="headerlink" href="#flexjson-narrow-json-description" title="Permalink to this headline">¶</a></h2>
<p>This section was created to address the use of JSON on Arduino/
C++ environments that have very limited CPUs and small memory.
The choice of the Nano BLE Sense 33 and the Xiao do not have
these restrictions.</p>
<p>The character set for the JSON permitted include only
Latin-7 characters; useful for encoding while preserving
some “in-band” testing.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a> (Javascript Object
Notation) provides a stateless, real-time peer-peer communications
protocol. It defines the “payload” of any communications wrapper.</p>
<p>JSON is well modeled by a Python Dictionary. A “dictionary” consists
of a Key:Value pair.  In the JSON world, a general restriction is to
have all characters within the string to be plain text (no ‘binary’
characters.) Integers are represented by their textual representation,
floats etc.  A JSON value may be a string, integer, float, list or
another dictionary.  It is the nested nature of the dictionary that
supports FlexSpec interoperability.</p>
<p>The Arduino Nano 33 BLE Sense and IoT have sufficient capability
to support the ArduinoJson library. This is well crafted to be
memory efficient.</p>
</div>
<div class="section" id="motors">
<h2><span class="section-number">12.4. </span>Motors<a class="headerlink" href="#motors" title="Permalink to this headline">¶</a></h2>
<p>ELEGOO 5 Sets 28BYJ-48 ULN2003 5V Stepper Motor + ULN2003 Driver Board Compatible with Arduino</p>
<p>ULN2803 Darlington driver</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">FlexSpec1</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="abstract.html">1. ABSTRACT</a></li>
<li class="toctree-l1"><a class="reference internal" href="flexspec1.html">2. Download FlexSpec1 Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="openquestions.html">3. Open Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ovio.html">4. OVIO Slit</a></li>
<li class="toctree-l1"><a class="reference internal" href="optics.html">5. Care of Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiments.html">6. Optical Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">7. OVERVIEW</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">8. Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="mathematics.html">9. Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="guiding.html">10. FlexSpec 1 Guiding</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol.html">11. Remote Protocol</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">12. FlexSpec 1 Ecosystem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#control-overview">12.1. Control Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-system">12.2. Control System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flexjson-narrow-json-description">12.3. FlexJSON – Narrow JSON Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#motors">12.4. Motors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="communication.html">13. Communications</a></li>
<li class="toctree-l1"><a class="reference internal" href="serial.html">14. Serial Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">15. User Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="cad.html">16. CAD Computer Aided Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="electronics.html">17. Electronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="arduino.html">18. Arduino Chips</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">19. Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">20. Using Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="bom.html">21. Bill of Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="callamps.html">22. Calibration Lamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="outstanding.html">23. Outstanding Documentation Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">24. References</a></li>
<li class="toctree-l1"><a class="reference internal" href="youtube.html">25. YouTube Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="printer.html">26. Printer</a></li>
<li class="toctree-l1"><a class="reference internal" href="merlin.html">27. MERLIN GCODE Tricks</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="protocol.html" title="previous chapter"><span class="section-number">11. </span>Remote Protocol</a></li>
      <li>Next: <a href="communication.html" title="next chapter"><span class="section-number">13. </span>Communications</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Jerrold L. Foote, Wayne Green, Greg Jones, Frank Parks, Anthony Rodda, Forrest Sims, Thomas C. Smith, Clarke Yeager.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/controls.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>